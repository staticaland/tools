<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interval Ear Trainer</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            min-height: 100vh;
            color: #eee;
        }

        h1 {
            text-align: center;
            color: #fff;
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 24px;
            font-size: 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 500;
        }

        .play-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-size: 18px;
            padding: 15px 40px;
        }

        .play-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        .play-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .settings {
            background: rgba(255,255,255,0.1);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
        }

        .settings h3 {
            margin-top: 0;
            color: #667eea;
        }

        .setting-row {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .setting-row label {
            min-width: 120px;
        }

        select {
            padding: 8px 15px;
            font-size: 14px;
            border-radius: 6px;
            border: 1px solid #444;
            background: #2a2a4a;
            color: #eee;
        }

        .intervals-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
            gap: 10px;
            margin-bottom: 30px;
        }

        .interval-btn {
            background: rgba(255,255,255,0.1);
            color: #ccc;
            border: 2px solid transparent;
            padding: 15px 10px;
            font-size: 14px;
        }

        .interval-btn:hover {
            background: rgba(255,255,255,0.2);
            color: #fff;
        }

        .interval-btn.correct {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
            border-color: #38ef7d;
        }

        .interval-btn.incorrect {
            background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%);
            color: white;
            border-color: #f45c43;
        }

        .interval-btn.highlight {
            border-color: #667eea;
            background: rgba(102, 126, 234, 0.3);
        }

        .stats {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 36px;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #888;
            font-size: 14px;
        }

        .feedback {
            text-align: center;
            font-size: 24px;
            min-height: 40px;
            margin-bottom: 20px;
        }

        .info-panel {
            background: rgba(255,255,255,0.05);
            padding: 20px;
            border-radius: 12px;
            margin-top: 30px;
        }

        .info-panel h3 {
            color: #667eea;
            margin-top: 0;
        }

        .interval-info {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
        }

        .interval-item {
            padding: 8px 12px;
            background: rgba(255,255,255,0.05);
            border-radius: 6px;
            font-size: 13px;
        }

        .interval-item strong {
            color: #667eea;
        }

        .piano-visual {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            position: relative;
            height: 120px;
        }

        .piano-key {
            width: 40px;
            height: 100px;
            background: white;
            border: 1px solid #333;
            border-radius: 0 0 4px 4px;
            position: relative;
            z-index: 1;
        }

        .piano-key.black {
            width: 25px;
            height: 60px;
            background: #222;
            margin-left: -12px;
            margin-right: -12px;
            z-index: 2;
        }

        .piano-key.active {
            background: #667eea;
        }

        .piano-key.black.active {
            background: #764ba2;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            cursor: pointer;
            font-size: 13px;
        }

        .checkbox-label:hover {
            background: rgba(255,255,255,0.15);
        }

        .checkbox-label input {
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>üéµ Interval Ear Trainer</h1>
    <p class="subtitle">Train your ear to recognize musical intervals</p>

    <div class="stats">
        <div class="stat">
            <div class="stat-value" id="correct">0</div>
            <div class="stat-label">Correct</div>
        </div>
        <div class="stat">
            <div class="stat-value" id="total">0</div>
            <div class="stat-label">Total</div>
        </div>
        <div class="stat">
            <div class="stat-value" id="percentage">0%</div>
            <div class="stat-label">Accuracy</div>
        </div>
    </div>

    <div class="controls">
        <button class="play-btn" id="playBtn">‚ñ∂ Play Interval</button>
        <button class="play-btn" id="repeatBtn" style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);">üîÅ Repeat</button>
    </div>

    <div class="feedback" id="feedback"></div>

    <div class="piano-visual" id="piano"></div>

    <div class="intervals-grid" id="intervalsGrid"></div>

    <div class="settings">
        <h3>‚öôÔ∏è Settings</h3>
        <div class="setting-row">
            <label>Direction:</label>
            <select id="direction">
                <option value="ascending">Ascending ‚Üë</option>
                <option value="descending">Descending ‚Üì</option>
                <option value="harmonic">Harmonic (together)</option>
                <option value="random">Random</option>
            </select>
        </div>
        <div class="setting-row">
            <label>Active Intervals:</label>
        </div>
        <div class="checkbox-group" id="intervalCheckboxes"></div>
    </div>

    <div class="info-panel">
        <h3>üìö Interval Reference</h3>
        <p>An <strong>interval</strong> is the distance between two notes. Here are the intervals within an octave:</p>
        <div class="interval-info" id="intervalInfo"></div>
        <p style="margin-top: 15px; color: #888; font-size: 13px;">
            <strong>Tip:</strong> Many intervals are associated with famous songs. For example, a Perfect 5th sounds like the start of "Star Wars" theme,
            and a Minor 2nd sounds like the "Jaws" theme!
        </p>
    </div>

    <script>
        const INTERVALS = [
            { semitones: 0, name: 'Unison', short: 'P1', song: 'Same note repeated' },
            { semitones: 1, name: 'Minor 2nd', short: 'm2', song: 'Jaws theme' },
            { semitones: 2, name: 'Major 2nd', short: 'M2', song: 'Happy Birthday (first two notes)' },
            { semitones: 3, name: 'Minor 3rd', short: 'm3', song: 'Greensleeves' },
            { semitones: 4, name: 'Major 3rd', short: 'M3', song: 'When the Saints Go Marching In' },
            { semitones: 5, name: 'Perfect 4th', short: 'P4', song: 'Here Comes the Bride' },
            { semitones: 6, name: 'Tritone', short: 'TT', song: 'The Simpsons theme' },
            { semitones: 7, name: 'Perfect 5th', short: 'P5', song: 'Star Wars theme' },
            { semitones: 8, name: 'Minor 6th', short: 'm6', song: 'The Entertainer' },
            { semitones: 9, name: 'Major 6th', short: 'M6', song: 'NBC chimes (first two)' },
            { semitones: 10, name: 'Minor 7th', short: 'm7', song: 'Star Trek theme' },
            { semitones: 11, name: 'Major 7th', short: 'M7', song: 'Take On Me (chorus)' },
            { semitones: 12, name: 'Octave', short: 'P8', song: 'Somewhere Over the Rainbow' }
        ];

        let audioContext = null;
        let currentInterval = null;
        let currentNotes = null;
        let stats = { correct: 0, total: 0 };
        let activeIntervals = new Set([1, 2, 3, 4, 5, 7, 12]); // Default intervals
        let isPlaying = false;

        function initAudio() {
            if (!audioContext) {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            }
            if (audioContext.state === 'suspended') {
                audioContext.resume();
            }
        }

        function midiToFreq(midi) {
            return 440 * Math.pow(2, (midi - 69) / 12);
        }

        function playNote(frequency, startTime, duration = 0.8) {
            const osc = audioContext.createOscillator();
            const gain = audioContext.createGain();

            osc.type = 'sine';
            osc.frequency.setValueAtTime(frequency, startTime);

            // Add some harmonics for a richer sound
            const osc2 = audioContext.createOscillator();
            osc2.type = 'triangle';
            osc2.frequency.setValueAtTime(frequency, startTime);

            const gain2 = audioContext.createGain();
            gain2.gain.setValueAtTime(0.3, startTime);

            gain.gain.setValueAtTime(0.5, startTime);
            gain.gain.exponentialRampToValueAtTime(0.01, startTime + duration);
            gain2.gain.exponentialRampToValueAtTime(0.01, startTime + duration);

            osc.connect(gain);
            osc2.connect(gain2);
            gain.connect(audioContext.destination);
            gain2.connect(audioContext.destination);

            osc.start(startTime);
            osc2.start(startTime);
            osc.stop(startTime + duration);
            osc2.stop(startTime + duration);
        }

        function playInterval(note1, note2, direction) {
            initAudio();
            const now = audioContext.currentTime;

            if (direction === 'harmonic') {
                playNote(midiToFreq(note1), now, 1.2);
                playNote(midiToFreq(note2), now, 1.2);
            } else {
                const firstNote = direction === 'descending' ? note2 : note1;
                const secondNote = direction === 'descending' ? note1 : note2;
                playNote(midiToFreq(firstNote), now, 0.7);
                playNote(midiToFreq(secondNote), now + 0.6, 0.7);
            }
        }

        function generateInterval() {
            const activeArray = Array.from(activeIntervals);
            if (activeArray.length === 0) {
                alert('Please select at least one interval!');
                return null;
            }

            const semitones = activeArray[Math.floor(Math.random() * activeArray.length)];
            const baseNote = 60 + Math.floor(Math.random() * 12); // C4 to B4

            let direction = document.getElementById('direction').value;
            if (direction === 'random') {
                const dirs = ['ascending', 'descending', 'harmonic'];
                direction = dirs[Math.floor(Math.random() * dirs.length)];
            }

            return {
                semitones,
                baseNote,
                topNote: baseNote + semitones,
                direction
            };
        }

        function newInterval() {
            currentInterval = generateInterval();
            if (!currentInterval) return;

            currentNotes = [currentInterval.baseNote, currentInterval.topNote];
            document.getElementById('feedback').textContent = 'Listen and guess the interval...';

            // Clear previous highlights
            document.querySelectorAll('.interval-btn').forEach(btn => {
                btn.classList.remove('correct', 'incorrect', 'highlight');
            });

            playCurrentInterval();
            updatePiano();
        }

        function playCurrentInterval() {
            if (!currentInterval || isPlaying) return;
            isPlaying = true;

            playInterval(currentInterval.baseNote, currentInterval.topNote, currentInterval.direction);

            setTimeout(() => { isPlaying = false; }, 1500);
        }

        function checkAnswer(semitones) {
            if (!currentInterval) {
                newInterval();
                return;
            }

            const buttons = document.querySelectorAll('.interval-btn');
            const correctBtn = document.querySelector(`[data-semitones="${currentInterval.semitones}"]`);
            const clickedBtn = document.querySelector(`[data-semitones="${semitones}"]`);

            stats.total++;

            if (semitones === currentInterval.semitones) {
                stats.correct++;
                document.getElementById('feedback').textContent = '‚úÖ Correct! ' + INTERVALS.find(i => i.semitones === semitones).name;
                clickedBtn.classList.add('correct');
            } else {
                document.getElementById('feedback').textContent = '‚ùå Not quite! It was ' + INTERVALS.find(i => i.semitones === currentInterval.semitones).name;
                clickedBtn.classList.add('incorrect');
                correctBtn.classList.add('highlight');
            }

            updateStats();

            // Auto-advance after delay
            setTimeout(() => {
                newInterval();
            }, 2000);
        }

        function updateStats() {
            document.getElementById('correct').textContent = stats.correct;
            document.getElementById('total').textContent = stats.total;
            const pct = stats.total > 0 ? Math.round((stats.correct / stats.total) * 100) : 0;
            document.getElementById('percentage').textContent = pct + '%';
        }

        function updatePiano() {
            const pianoEl = document.getElementById('piano');
            pianoEl.innerHTML = '';

            // Show a small piano section around the played notes
            const minNote = Math.min(...currentNotes) - 2;
            const maxNote = Math.max(...currentNotes) + 2;

            const blackKeys = [1, 3, 6, 8, 10]; // Relative to C

            for (let midi = minNote; midi <= maxNote; midi++) {
                const noteInOctave = midi % 12;
                const isBlack = blackKeys.includes(noteInOctave);
                const isActive = currentNotes.includes(midi);

                const key = document.createElement('div');
                key.className = 'piano-key' + (isBlack ? ' black' : '') + (isActive ? ' active' : '');
                pianoEl.appendChild(key);
            }
        }

        function createIntervalButtons() {
            const grid = document.getElementById('intervalsGrid');
            grid.innerHTML = '';

            INTERVALS.forEach(interval => {
                const btn = document.createElement('button');
                btn.className = 'interval-btn';
                btn.dataset.semitones = interval.semitones;
                btn.textContent = `${interval.short} - ${interval.name}`;
                btn.onclick = () => checkAnswer(interval.semitones);
                grid.appendChild(btn);
            });
        }

        function createIntervalCheckboxes() {
            const container = document.getElementById('intervalCheckboxes');
            container.innerHTML = '';

            INTERVALS.forEach(interval => {
                const label = document.createElement('label');
                label.className = 'checkbox-label';

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = activeIntervals.has(interval.semitones);
                checkbox.onchange = () => {
                    if (checkbox.checked) {
                        activeIntervals.add(interval.semitones);
                    } else {
                        activeIntervals.delete(interval.semitones);
                    }
                };

                label.appendChild(checkbox);
                label.appendChild(document.createTextNode(interval.short));
                container.appendChild(label);
            });
        }

        function createIntervalInfo() {
            const info = document.getElementById('intervalInfo');
            info.innerHTML = '';

            INTERVALS.forEach(interval => {
                const item = document.createElement('div');
                item.className = 'interval-item';
                item.innerHTML = `<strong>${interval.short}</strong> ${interval.name}<br><small style="color:#888">${interval.song}</small>`;
                info.appendChild(item);
            });
        }

        // Initialize
        createIntervalButtons();
        createIntervalCheckboxes();
        createIntervalInfo();

        document.getElementById('playBtn').onclick = newInterval;
        document.getElementById('repeatBtn').onclick = playCurrentInterval;
    </script>
</body>
</html>
